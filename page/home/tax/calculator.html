<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>คำนวณภาษี - Tax Calculator</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Shared CSS -->
    <link rel="stylesheet" href="../../../function/shared/css/fonts.css">

    <!-- User Portal CSS -->
    <link rel="stylesheet" href="../../../function/home/css/user-base.css">

    <style>
        /* Page-specific: Wallpaper handled by user-base.css .bg-tax class */
        /* Consistent form field spacing */
        .deduction-card label {
            display: flex !important;
            align-items: center;
            gap: 4px;
            min-height: 20px;
            line-height: 1.25;
            margin-bottom: 8px !important;
        }

        /* Reset Tailwind space-y-4 and apply consistent spacing */
        .deduction-card .space-y-4>*+* {
            margin-top: 16px !important;
        }

        .deduction-card .space-y-4>*:first-child {
            margin-top: 0 !important;
        }

        /* Fix tooltip icon alignment */
        .deduction-card label svg {
            flex-shrink: 0;
        }

        /* Touch-friendly tooltip */
        .tooltip-trigger {
            position: relative;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .tooltip-content {
            padding: 8px 12px;
            background: #1f2937;
            color: white;
            font-size: 12px;
            border-radius: 8px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
            z-index: 9999;
            pointer-events: none;
        }

        /* Desktop: positioned tooltip above icon */
        @media (min-width: 1024px) {
            .tooltip-content {
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
                bottom: 100%;
                margin-bottom: 8px;
                white-space: nowrap;
            }

            .tooltip-content::after {
                content: '';
                position: absolute;
                top: 100%;
                left: 50%;
                transform: translateX(-50%);
                border: 6px solid transparent;
                border-top-color: #1f2937;
            }

            .tooltip-trigger:hover .tooltip-content {
                opacity: 1;
                visibility: visible;
            }
        }

        /* Mobile: fixed centered tooltip */
        @media (max-width: 1023px) {
            .tooltip-content {
                position: fixed;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                max-width: 90%;
                text-align: center;
                white-space: normal;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            }

            .tooltip-trigger.active .tooltip-content {
                opacity: 1;
                visibility: visible;
            }
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Handle tooltip trigger clicks (mobile only)
            document.querySelectorAll('.tooltip-trigger').forEach(function (trigger) {
                trigger.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();

                    // Only handle on mobile
                    if (window.innerWidth < 1024) {
                        // Close all other tooltips
                        document.querySelectorAll('.tooltip-trigger.active').forEach(function (other) {
                            if (other !== trigger) {
                                other.classList.remove('active');
                            }
                        });

                        // Toggle this tooltip
                        this.classList.toggle('active');
                    }
                });
            });

            // Close tooltip when tapping elsewhere
            document.addEventListener('click', function (e) {
                if (!e.target.closest('.tooltip-trigger')) {
                    document.querySelectorAll('.tooltip-trigger.active').forEach(function (trigger) {
                        trigger.classList.remove('active');
                    });
                }
            });
        });
    </script>
</head>

<body class="min-h-screen">

    <!-- Background Wrapper (iOS Compatible) -->
    <div class="bg-wrapper bg-tax"></div>


    <!-- Navbar Component -->
    <div id="navbar-container" data-page-title="คำนวณภาษี" data-page-subtitle="คำนวณภาษีเงินได้บุคคลธรรมดา"
        data-icon-color="bg-emerald-100"
        data-icon-svg="<svg class='w-6 h-6 text-emerald-600' fill='none' stroke='currentColor' viewBox='0 0 24 24'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z'/></svg>">
    </div>
    <script src="../../../function/home/components/navbar.js"></script>

    <!-- Main Content -->
    <main class="pt-4 pb-8 px-4 max-w-4xl lg:max-w-4xl mx-auto">

        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center gap-4 mb-4">
                <div class="w-14 h-14 bg-emerald-100 rounded-3xl flex items-center justify-center">
                    <svg class="w-7 h-7 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                            d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                    </svg>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">คำนวณภาษี</h1>
                    <p class="text-gray-500 text-sm">คำนวณภาษีเงินได้บุคคลธรรมดา</p>
                </div>
            </div>
        </div>

        <!-- Income Section Card -->
        <div class="bg-white/70 backdrop-blur-xl rounded-[2.5rem] shadow-lg p-6 border border-gray-200 lg:p-8 mb-6">
            <h2 class="text-lg font-semibold text-emerald-600 mb-4 pb-2 border-b border-emerald-200">รายได้</h2>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">เงินเดือน (ต่อเดือน)</label>
                    <div class="relative">
                        <input type="number" id="salaryMonthly"
                            class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                            onchange="updateTotalYearlyIncome()">
                        <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                    </div>
                    <input type="hidden" id="salary" value="0">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">โบนัส (ต่อปี)</label>
                    <div class="relative">
                        <input type="number" id="bonus"
                            class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                            onchange="updateTotalYearlyIncome()">
                        <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">รายได้อื่นๆ (ต่อปี)</label>
                    <div class="relative">
                        <input type="number" id="otherIncome"
                            class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                            onchange="updateTotalYearlyIncome()">
                        <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                    </div>
                </div>
            </div>

            <!-- Total Yearly Income Display -->
            <div class="bg-emerald-50 rounded-3xl p-4 border border-emerald-200">
                <div class="flex items-baseline justify-between">
                    <span class="text-gray-900 font-medium">รายได้รวมต่อปี</span>
                    <span class="flex items-baseline gap-1"><span class="text-2xl font-bold text-emerald-600"
                            id="totalYearlyIncomeDisplay">0</span><span
                            class="text-gray-900 font-medium">บาท</span></span>
                </div>
            </div>
        </div>

        <!-- Deductions Section Card -->
        <div
            class="deduction-card bg-white/70 backdrop-blur-xl rounded-[2.5rem] shadow-lg p-6 border border-gray-200 lg:p-8 mb-6">
            <h2 class="text-lg font-semibold text-emerald-600 mb-4 pb-2 border-b border-emerald-200">รายการลดหย่อน</h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <!-- Expense Deduction -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">หักค่าใช้จ่าย</label>
                    <div class="relative">
                        <input type="text" id="expenseDeduction" value="100,000"
                            class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50" readonly>
                        <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                    </div>
                </div>

                <!-- Personal Deduction -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ค่าลดหย่อนส่วนตัว</label>
                    <div class="relative">
                        <input type="text" id="personalDeduction" value="60,000"
                            class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50" readonly>
                        <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                    </div>
                </div>
            </div>

            <div class="space-y-4 mt-4">
                <!-- Marital Status -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">สถานภาพ</label>
                    <input type="hidden" id="maritalStatus" value="single">
                    <div class="flex flex-wrap gap-2">
                        <button type="button" onclick="selectMaritalStatus('single')" id="btn-single"
                            class="marital-pill px-4 py-2 rounded-full border-2 transition-all text-sm font-medium border-emerald-500 bg-emerald-500 text-white">
                            โสด
                        </button>
                        <button type="button" onclick="selectMaritalStatus('divorced')" id="btn-divorced"
                            class="marital-pill px-4 py-2 rounded-full border-2 transition-all text-sm font-medium border-gray-300 bg-white text-gray-600 hover:border-emerald-400">
                            หย่า
                        </button>
                        <button type="button" onclick="selectMaritalStatus('married_income')" id="btn-married_income"
                            class="marital-pill px-4 py-2 rounded-full border-2 transition-all text-sm font-medium border-gray-300 bg-white text-gray-600 hover:border-emerald-400">
                            คู่สมรส มีเงินได้
                        </button>
                        <button type="button" onclick="selectMaritalStatus('married_no_income')"
                            id="btn-married_no_income"
                            class="marital-pill px-4 py-2 rounded-full border-2 transition-all text-sm font-medium border-gray-300 bg-white text-gray-600 hover:border-emerald-400">
                            คู่สมรส ไม่มีเงินได้
                        </button>
                    </div>
                </div>
            </div>

            <div class="space-y-4 mt-4">
                <!-- Spouse Deduction (hidden by default) -->
                <div id="spouseDeductionDiv" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ค่าลดหย่อนคู่สมรส</label>
                    <div class="relative">
                        <input type="number" id="spouseDeduction" value="60000"
                            class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50" readonly>
                        <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                    </div>
                </div>

                <!-- Pregnancy and Childbirth Deduction -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        ค่าลดหย่อนฝากครรภ์และคลอดบุตร
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">ค่าลดหย่อนฝากครรภ์และคลอดบุตร สูงสุด 60,000 บาท
                                ต่อการตั้งครรภ์</span>
                        </span>
                    </label>
                    <div class="relative">
                        <input type="number" id="pregnancyDeduction"
                            class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                            max="60000">
                        <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                    </div>
                </div>

                <!-- Child Deduction -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        ค่าลดหย่อนบุตร
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">ค่าลดหย่อนบุตร คนละ 30,000 บาท</span>
                        </span>
                    </label>
                    <div class="flex items-center gap-3">
                        <div class="relative flex-1">
                            <input type="number" id="childCount"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                min="0" onchange="updateChildDeduction()">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">คน</span>
                        </div>
                        <div class="relative flex-1">
                            <input type="number" id="childDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50" readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- Child Born from 2561 Deduction -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        บุตรคนที่ 2 เป็นต้นไปที่เกิดตั้งแต่ปี 2561
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">บุตรคนที่ 2 เป็นต้นไปที่เกิดตั้งแต่ปี 2561 ลดหย่อนได้คนละ
                                60,000 บาท</span>
                        </span>
                    </label>
                    <div class="flex items-center gap-3">
                        <div class="relative flex-1">
                            <input type="number" id="child2561Count"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                min="0" onchange="updateChild2561Deduction()">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">คน</span>
                        </div>
                        <div class="relative flex-1">
                            <input type="number" id="child2561Deduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50" readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- Parent Deduction -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        ค่าลดหย่อนบิดา-มารดา
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">ค่าลดหย่อนบิดา-มารดา คนละ 30,000 บาท (สูงสุด 4 คน)</span>
                        </span>
                    </label>
                    <div class="flex items-center gap-3">
                        <div class="relative flex-1">
                            <input type="number" id="parentCount"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                min="0" max="4" onchange="updateParentDeduction()">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">คน</span>
                        </div>
                        <div class="relative flex-1">
                            <input type="number" id="parentDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50" readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- Disabled Person Care Deduction -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        ค่าลดหย่อน อุปการะผู้พิการ-ทุพพลภาพ
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">ค่าลดหย่อน อุปการะผู้พิการ-ทุพพลภาพ คนละ 60,000 บาท</span>
                        </span>
                    </label>
                    <div class="flex items-center gap-3">
                        <div class="relative flex-1">
                            <input type="number" id="disabledCount"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                min="0" onchange="updateDisabledDeduction()">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">คน</span>
                        </div>
                        <div class="relative flex-1">
                            <input type="number" id="disabledDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50" readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Economic Stimulus Card -->
        <div
            class="deduction-card bg-white/70 backdrop-blur-xl rounded-[2.5rem] shadow-lg p-6 border border-gray-200 lg:p-8 mb-6">
            <h2 class="text-lg font-semibold text-emerald-600 mb-4 pb-2 border-b border-emerald-200">
                กลุ่มกระตุ้นเศรษฐกิจ</h2>

            <div class="space-y-4">
                <!-- Easy E-Receipt -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        Easy E-Receipt
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">Easy E-Receipt ไม่เกิน 50,000 บาท</span>
                        </span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <input type="number" id="easyEReceipt"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                max="50000"
                                onchange="updateEconomicDeduction('easyEReceipt', 'easyEReceiptDeduction', 50000)">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative">
                            <input type="text" id="easyEReceiptDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50 text-gray-600 font-medium"
                                readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- Housing Interest -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        ดอกเบี้ยที่อยู่อาศัย
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">ดอกเบี้ยที่อยู่อาศัย ไม่เกิน 100,000 บาท</span>
                        </span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <input type="number" id="housingInterest"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                max="100000"
                                onchange="updateEconomicDeduction('housingInterest', 'housingInterestDeduction', 100000)">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative">
                            <input type="text" id="housingInterestDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50 text-gray-600 font-medium"
                                readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- New Home Construction 2567-2568 -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        ค่าสร้างบ้านใหม่ 2567 - 2568
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">ค่าสร้างบ้านใหม่ 2567 - 2568 ไม่เกิน 100,000 บาท</span>
                        </span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <input type="number" id="newHomeConstruction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                max="100000"
                                onchange="updateEconomicDeduction('newHomeConstruction', 'newHomeConstructionDeduction', 100000)">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative">
                            <input type="text" id="newHomeConstructionDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50 text-gray-600 font-medium"
                                readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- Solar Cell Installation -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        ค่าติดตั้งโซล่าเซลล์สำหรับที่อยู่อาศัย
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">ค่าติดตั้งโซล่าเซลล์สำหรับที่อยู่อาศัย ไม่เกิน 200,000
                                บาท</span>
                        </span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <input type="number" id="solarCellInstallation"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                max="200000"
                                onchange="updateEconomicDeduction('solarCellInstallation', 'solarCellInstallationDeduction', 200000)">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative">
                            <input type="text" id="solarCellInstallationDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50 text-gray-600 font-medium"
                                readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- Visual Art Purchase -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        ค่าซื้องานศิลปะด้านทัศนศิลป์
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">ค่าซื้องานศิลปะด้านทัศนศิลป์ ไม่เกิน 100,000 บาท</span>
                        </span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <input type="number" id="visualArtPurchase"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                max="100000"
                                onchange="updateEconomicDeduction('visualArtPurchase', 'visualArtPurchaseDeduction', 100000)">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative">
                            <input type="text" id="visualArtPurchaseDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50 text-gray-600 font-medium"
                                readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Life Insurance Card -->
        <div
            class="deduction-card bg-white/70 backdrop-blur-xl rounded-[2.5rem] shadow-lg p-6 border border-gray-200 lg:p-8 mb-6">
            <h2 class="text-lg font-semibold text-emerald-600 mb-4 pb-2 border-b border-emerald-200">กลุ่มประกันชีวิต
            </h2>

            <div class="space-y-4">
                <!-- General Life Insurance -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        ประกันชีวิตทั่วไป/ประกันสะสมทรัพย์
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">ประกันชีวิตทั่วไป/ประกันสะสมทรัพย์ ไม่เกิน 100,000 บาท</span>
                        </span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <input type="number" id="lifeInsurance"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                max="100000"
                                onchange="updateInsuranceDeduction('lifeInsurance', 'lifeInsuranceDeduction', 100000)">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative">
                            <input type="text" id="lifeInsuranceDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50 text-gray-600 font-medium"
                                readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- Personal Health Insurance -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        ประกันสุขภาพตัวเอง
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">ประกันสุขภาพตัวเอง ลดหย่อนได้ 25,000 บาท
                                (รวมประกันชีวิตไม่เกิน 100,000 บาท)</span>
                        </span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <input type="number" id="healthInsurance"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                max="25000"
                                onchange="updateInsuranceDeduction('healthInsurance', 'healthInsuranceDeduction', 25000)">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative">
                            <input type="text" id="healthInsuranceDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50 text-gray-600 font-medium"
                                readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- Parent Health Insurance -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        ประกันสุขภาพบิดามารดา
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">ประกันสุขภาพบิดามารดา ไม่เกิน 15,000 บาท</span>
                        </span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <input type="number" id="parentHealthInsurance"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                max="15000"
                                onchange="updateInsuranceDeduction('parentHealthInsurance', 'parentHealthInsuranceDeduction', 15000)">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative">
                            <input type="text" id="parentHealthInsuranceDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50 text-gray-600 font-medium"
                                readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- Spouse Life Insurance -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        ประกันชีวิตคู่สมรส
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">ประกันชีวิตคู่สมรส ไม่เกิน 10,000 บาท</span>
                        </span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <input type="number" id="spouseLifeInsurance"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                max="10000"
                                onchange="updateInsuranceDeduction('spouseLifeInsurance', 'spouseLifeInsuranceDeduction', 10000)">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative">
                            <input type="text" id="spouseLifeInsuranceDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50 text-gray-600 font-medium"
                                readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- Social Security -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        ประกันสังคม
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">ประกันสังคม ไม่เกิน 10,500 บาท</span>
                        </span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <input type="number" id="socialSecurity"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                max="10500"
                                onchange="updateInsuranceDeduction('socialSecurity', 'socialSecurityDeduction', 10500)">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative">
                            <input type="text" id="socialSecurityDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50 text-gray-600 font-medium"
                                readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Investment Group Card -->
        <div
            class="deduction-card bg-white/70 backdrop-blur-xl rounded-[2.5rem] shadow-lg p-6 border border-gray-200 lg:p-8 mb-6">
            <div class="mb-4 pb-2 border-b border-emerald-200">
                <h2 class="text-lg font-semibold text-emerald-600">กลุ่มการลงทุน</h2>
                <p class="text-xs text-gray-500 mt-1">เมื่อรวมกับประกันชีวิตแบบบำนาญแล้ว ไม่เกิน 500,000.00 บาท</p>
            </div>

            <div class="space-y-4">
                <!-- PVD Fund -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        กองทุน PVD, สงเคราะห์ครู
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">กองทุน PVD, สงเคราะห์ครู ไม่เกิน 15% ของรายได้ สูงสุด 500,000
                                บาท</span>
                        </span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <input type="number" id="pvdFund"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                max="500000"
                                onchange="updateInvestmentDeduction('pvdFund', 'pvdFundDeduction', 500000, 15)">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative">
                            <input type="text" id="pvdFundDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50 text-gray-600 font-medium"
                                readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- GPF -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        กบข.
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">กบข. ไม่เกิน 30% ของรายได้ สูงสุด 500,000 บาท</span>
                        </span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <input type="number" id="gpfFund"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                max="500000"
                                onchange="updateInvestmentDeduction('gpfFund', 'gpfFundDeduction', 500000, 30)">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative">
                            <input type="text" id="gpfFundDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50 text-gray-600 font-medium"
                                readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- Annuity Insurance -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        ประกันบำนาญ
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">ประกันบำนาญ ไม่เกิน 15% ของรายได้ สูงสุด 200,000 บาท</span>
                        </span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <input type="number" id="annuityInsurance"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                max="200000"
                                onchange="updateInvestmentDeduction('annuityInsurance', 'annuityInsuranceDeduction', 200000, 15)">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative">
                            <input type="text" id="annuityInsuranceDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50 text-gray-600 font-medium"
                                readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- National Savings Fund -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        กองทุนการออมเงินแห่งชาติ
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">กองทุนการออมเงินแห่งชาติ ไม่เกิน 30,000 บาท</span>
                        </span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <input type="number" id="nsfFund"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                max="30000" onchange="updateInvestmentDeduction('nsfFund', 'nsfFundDeduction', 30000)">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative">
                            <input type="text" id="nsfFundDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50 text-gray-600 font-medium"
                                readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- RMF Fund -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        กองทุน RMF
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">กองทุน RMF ไม่เกิน 30% ของรายได้ สูงสุด 500,000 บาท</span>
                        </span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <input type="number" id="rmfFund"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                max="500000"
                                onchange="updateInvestmentDeduction('rmfFund', 'rmfFundDeduction', 500000, 30)">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative">
                            <input type="text" id="rmfFundDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50 text-gray-600 font-medium"
                                readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- Social Enterprise Investment -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        เงินลงทุนธุรกิจ Social Enterprise
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">เงินลงทุนธุรกิจ Social Enterprise ไม่เกิน 100,000 บาท</span>
                        </span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <input type="number" id="socialEnterprise"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                max="100000"
                                onchange="updateInvestmentDeduction('socialEnterprise', 'socialEnterpriseDeduction', 100000)">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative">
                            <input type="text" id="socialEnterpriseDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50 text-gray-600 font-medium"
                                readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- ThaiESG Fund -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        กองทุน ThaiESG
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">กองทุน ThaiESG ไม่เกิน 30% ของรายได้ สูงสุด 300,000 บาท</span>
                        </span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <input type="number" id="thaiEsgFund"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                max="300000"
                                onchange="updateInvestmentDeduction('thaiEsgFund', 'thaiEsgFundDeduction', 300000, 30)">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative">
                            <input type="text" id="thaiEsgFundDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50 text-gray-600 font-medium"
                                readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Donation Group Card -->
        <div
            class="deduction-card bg-white/70 backdrop-blur-xl rounded-[2.5rem] shadow-lg p-6 border border-gray-200 lg:p-8 mb-6">
            <h2 class="text-lg font-semibold text-emerald-600 mb-4 pb-2 border-b border-emerald-200">กลุ่มเงินบริจาค
            </h2>

            <div class="space-y-4">
                <!-- Political Party Donation -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        พรรคการเมือง
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">พรรคการเมือง ไม่เกิน 10,000 บาท</span>
                        </span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <input type="number" id="politicalDonation"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                max="10000"
                                onchange="updateDonationDeduction('politicalDonation', 'politicalDonationDeduction', 10000)">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative">
                            <input type="text" id="politicalDonationDeduction"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50 text-gray-600 font-medium"
                                readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- Education/Sports/Hospital Donation -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        การศึกษา กีฬา พัฒนาสังคม โรงพยาบาลรัฐ
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">การศึกษา กีฬา พัฒนาสังคม โรงพยาบาลรัฐ ไม่เกิน 10%
                                ของรายได้หลังหักค่าลดหย่อน (2 เท่า)</span>
                        </span>
                    </label>
                    <div class="flex items-center gap-3">
                        <div class="relative flex-1">
                            <input type="number" id="educationDonation"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                onchange="updateEducationDeduction()">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative flex-1">
                            <input type="number" id="educationDeductionAmount"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50" readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- General Donation -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        เงินบริจาคทั่วไป
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">เงินบริจาคทั่วไป ไม่เกิน 10% ของรายได้หลังหักค่าลดหย่อน
                                (ตามที่จ่ายจริง)</span>
                        </span>
                    </label>
                    <div class="flex items-center gap-3">
                        <div class="relative flex-1">
                            <input type="number" id="generalDonation"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                onchange="updateGeneralDonationDeduction()">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative flex-1">
                            <input type="number" id="generalDonationAmount"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50" readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>

                <!-- e-Donation -->
                <div>
                    <label class="flex items-center gap-1 text-sm font-medium text-gray-700 mb-2">
                        เงินบริจาคผ่านระบบบริจาคอิเล็กทรอนิกส์
                        <span class="tooltip-trigger">
                            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="tooltip-content">เงินบริจาคผ่านระบบบริจาคอิเล็กทรอนิกส์ (e-Donation) ลดหย่อนได้
                                2 เท่าของเงินบริจาค</span>
                        </span>
                    </label>
                    <div class="flex items-center gap-3">
                        <div class="relative flex-1">
                            <input type="number" id="eDonation"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                onchange="updateEDonationDeduction()">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                        <div class="relative flex-1">
                            <input type="number" id="eDonationAmount"
                                class="w-full px-4 py-3 border border-gray-200 rounded-3xl bg-gray-50" readonly>
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">บาท</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calculate Button -->
        <button onclick="calculateTax()"
            class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-4 rounded-3xl transition-colors shadow-lg shadow-emerald-200 mb-6">
            คำนวณภาษี
        </button>

        <!-- Results Section Card -->
        <div id="results"
            class="hidden bg-white/70 backdrop-blur-xl rounded-[2.5rem] shadow-lg p-6 border border-gray-200 lg:p-8">
            <h3 class="text-lg font-semibold text-emerald-600 mb-4 pb-2 border-b border-emerald-200">ผลการคำนวณ</h3>

            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-600">รายได้รวม</span>
                    <span id="totalIncome" class="font-medium text-gray-900">0 บาท</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">หักค่าใช้จ่าย (50%)</span>
                    <span id="expenseDeductionResult" class="font-medium text-gray-900">0 บาท</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">ค่าลดหย่อนรวม</span>
                    <span id="totalDeduction" class="font-medium text-gray-900">0 บาท</span>
                </div>
                <div class="h-px bg-emerald-200 my-2"></div>
                <div class="flex justify-between">
                    <span class="text-gray-600">เงินได้สุทธิ</span>
                    <span id="netIncome" class="font-medium text-gray-900">0 บาท</span>
                </div>
                <div class="flex justify-between text-lg pt-2">
                    <span class="font-semibold text-emerald-700">ภาษีที่ต้องชำระ</span>
                    <span id="taxAmount" class="font-bold text-emerald-600">0 บาท</span>
                </div>
            </div>
        </div>

    </main>

    <script>
        // Helper function to format number with commas
        function formatNumber(num) {
            return num.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 2 });
        }

        // Helper function to parse number with commas
        function parseNumber(str) {
            if (typeof str === 'number') return str;
            return parseFloat(String(str).replace(/,/g, '')) || 0;
        }

        // Format input field value with commas
        function formatInput(input) {
            const value = parseNumber(input.value);
            if (value > 0) {
                input.value = formatNumber(value);
            }
        }

        // Update investment deduction display
        function updateInvestmentDeduction(inputId, outputId, maxValue, percentLimit) {
            const inputValue = parseNumber(document.getElementById(inputId).value);
            const yearlySalary = parseNumber(document.getElementById('salary').value);

            // Calculate max based on percentage of salary if provided
            let maxByPercent = maxValue;
            if (percentLimit) {
                maxByPercent = yearlySalary * (percentLimit / 100);
            }

            // Take the minimum of: input, percentage limit, and absolute max
            const actualMax = Math.min(maxByPercent, maxValue);
            const deduction = Math.min(inputValue, actualMax);
            document.getElementById(outputId).value = deduction > 0 ? formatNumber(deduction) : '';
        }

        // Initialize formatting for all number inputs on page load
        document.addEventListener('DOMContentLoaded', function () {
            const numberInputs = document.querySelectorAll('input[type="number"], input[type="text"].format-number');
            numberInputs.forEach(function (input) {
                // Change type from number to text for formatting
                if (input.type === 'number') {
                    input.type = 'text';
                    input.inputMode = 'numeric';
                }

                // Format on blur
                input.addEventListener('blur', function () {
                    formatInput(this);
                });

                // Format on input (allow typing but format when done)
                input.addEventListener('input', function () {
                    // Remove non-numeric characters except comma and dot
                    this.value = this.value.replace(/[^\d.,]/g, '');
                });
            });
        });

        // Update economic stimulus deduction display
        function updateEconomicDeduction(inputId, outputId, maxValue) {
            const inputValue = parseNumber(document.getElementById(inputId).value);
            const deduction = Math.min(inputValue, maxValue);
            document.getElementById(outputId).value = deduction > 0 ? formatNumber(deduction) : '';
        }

        // Update insurance deduction display
        function updateInsuranceDeduction(inputId, outputId, maxValue) {
            const inputValue = parseNumber(document.getElementById(inputId).value);
            const deduction = Math.min(inputValue, maxValue);
            document.getElementById(outputId).value = deduction > 0 ? formatNumber(deduction) : '';
        }

        // Update donation deduction display
        function updateDonationDeduction(inputId, outputId, maxValue) {
            const inputValue = parseNumber(document.getElementById(inputId).value);
            const deduction = Math.min(inputValue, maxValue);
            document.getElementById(outputId).value = deduction > 0 ? formatNumber(deduction) : '';
        }

        function updateSpouseDeduction() {
            const maritalStatus = document.getElementById('maritalStatus').value;
            const spouseDeductionDiv = document.getElementById('spouseDeductionDiv');

            if (maritalStatus === 'married_no_income') {
                spouseDeductionDiv.classList.remove('hidden');
            } else {
                spouseDeductionDiv.classList.add('hidden');
            }
        }

        function selectMaritalStatus(status) {
            // Update hidden input value
            document.getElementById('maritalStatus').value = status;

            // Remove active state from all pills
            document.querySelectorAll('.marital-pill').forEach(btn => {
                btn.classList.remove('border-emerald-500', 'bg-emerald-500', 'text-white');
                btn.classList.add('border-gray-300', 'bg-white', 'text-gray-600');
            });

            // Add active state to selected pill
            const selectedBtn = document.getElementById('btn-' + status);
            if (selectedBtn) {
                selectedBtn.classList.remove('border-gray-300', 'bg-white', 'text-gray-600');
                selectedBtn.classList.add('border-emerald-500', 'bg-emerald-500', 'text-white');
            }

            // Trigger spouse deduction update
            updateSpouseDeduction();
        }

        function updateChildDeduction() {
            const count = parseInt(document.getElementById('childCount').value) || 0;
            const deduction = count * 30000;
            document.getElementById('childDeduction').value = formatNumber(deduction);
        }

        function updateChild2561Deduction() {
            const count = parseInt(document.getElementById('child2561Count').value) || 0;
            const deduction = count * 60000;
            document.getElementById('child2561Deduction').value = formatNumber(deduction);
        }

        function updateTotalYearlyIncome() {
            const monthly = parseNumber(document.getElementById('salaryMonthly').value);
            const yearlySalary = monthly * 12;
            const bonus = parseNumber(document.getElementById('bonus').value);
            const otherIncome = parseNumber(document.getElementById('otherIncome').value);

            // Update hidden salary field
            document.getElementById('salary').value = yearlySalary;

            // Calculate total yearly income
            const totalYearlyIncome = yearlySalary + bonus + otherIncome;
            document.getElementById('totalYearlyIncomeDisplay').textContent = formatNumber(totalYearlyIncome);
        }

        function updateParentDeduction() {
            const count = Math.min(parseInt(document.getElementById('parentCount').value) || 0, 4);
            const deduction = count * 30000;
            document.getElementById('parentDeduction').value = formatNumber(deduction);
        }

        function updateDisabledDeduction() {
            const count = parseInt(document.getElementById('disabledCount').value) || 0;
            const deduction = count * 60000;
            document.getElementById('disabledDeduction').value = formatNumber(deduction);
        }

        function updateEducationDeduction() {
            const donation = parseNumber(document.getElementById('educationDonation').value);
            const doubledDeduction = donation * 2; // 2 times of donation

            // Get all income values
            const salary = parseNumber(document.getElementById('salary').value);
            const bonus = parseNumber(document.getElementById('bonus').value);
            const otherIncome = parseNumber(document.getElementById('otherIncome').value);
            const totalIncome = salary + bonus + otherIncome;
            const expenseDeduction = 100000;

            // Personal deductions
            const personalDeduction = 60000;
            const maritalStatus = document.getElementById('maritalStatus').value;
            const spouseDeduction = (maritalStatus === 'married_no_income') ? 60000 : 0;
            const pregnancyDeduction = Math.min(parseNumber(document.getElementById('pregnancyDeduction').value), 60000);
            const childDeduction = parseNumber(document.getElementById('childDeduction').value);
            const child2561Deduction = parseNumber(document.getElementById('child2561Deduction').value);
            const parentDeduction = parseNumber(document.getElementById('parentDeduction').value);
            const disabledDeduction = parseNumber(document.getElementById('disabledDeduction').value);

            // Economic stimulus deductions
            const easyEReceipt = Math.min(parseNumber(document.getElementById('easyEReceipt').value), 50000);
            const housingInterest = Math.min(parseNumber(document.getElementById('housingInterest').value), 100000);
            const newHomeConstruction = Math.min(parseNumber(document.getElementById('newHomeConstruction').value), 100000);
            const solarCellInstallation = Math.min(parseNumber(document.getElementById('solarCellInstallation').value), 200000);
            const visualArtPurchase = Math.min(parseNumber(document.getElementById('visualArtPurchase').value), 100000);

            // Insurance deductions
            const lifeInsurance = Math.min(parseNumber(document.getElementById('lifeInsurance').value), 100000);
            const healthInsurance = Math.min(parseNumber(document.getElementById('healthInsurance').value), 25000);
            const parentHealthInsurance = Math.min(parseNumber(document.getElementById('parentHealthInsurance').value), 15000);
            const spouseLifeInsurance = Math.min(parseNumber(document.getElementById('spouseLifeInsurance').value), 10000);
            const socialSecurity = Math.min(parseNumber(document.getElementById('socialSecurity').value), 9000);
            const socialSecurityContribution = 10500;

            // Investment deductions
            const pvdFund = Math.min(parseNumber(document.getElementById('pvdFund').value), 500000);
            const gpfFund = Math.min(parseNumber(document.getElementById('gpfFund').value), 500000);
            const annuityInsurance = Math.min(parseNumber(document.getElementById('annuityInsurance').value), 200000);
            const nsfFund = Math.min(parseNumber(document.getElementById('nsfFund').value), 30000);
            const rmfFund = Math.min(parseNumber(document.getElementById('rmfFund').value), 500000);
            const socialEnterprise = Math.min(parseNumber(document.getElementById('socialEnterprise').value), 100000);
            const thaiEsgFund = Math.min(parseNumber(document.getElementById('thaiEsgFund').value), 300000);

            // Political donation
            const politicalDonation = Math.min(parseNumber(document.getElementById('politicalDonation').value), 10000);

            // Calculate basic deductions (not including general donation)
            const basicDeductions = personalDeduction + spouseDeduction + pregnancyDeduction + childDeduction + child2561Deduction + parentDeduction + disabledDeduction + easyEReceipt + housingInterest + newHomeConstruction + solarCellInstallation + visualArtPurchase + lifeInsurance + healthInsurance + parentHealthInsurance + spouseLifeInsurance + socialSecurity + socialSecurityContribution;

            // Combined investment deduction cap (cannot exceed 500,000)
            const totalInvestmentRaw = pvdFund + gpfFund + annuityInsurance + nsfFund + rmfFund + thaiEsgFund;
            const totalInvestment = Math.min(totalInvestmentRaw, 500000) + socialEnterprise;

            // Calculate income after all deductions (not including general donation)
            const incomeAfterDeductions = Math.max(totalIncome - expenseDeduction - basicDeductions - totalInvestment - politicalDonation, 0);

            // 10% limit
            const donationLimit = incomeAfterDeductions * 0.10;
            const cappedDeduction = Math.min(doubledDeduction, donationLimit);
            document.getElementById('educationDeductionAmount').value = formatNumber(cappedDeduction);
        }

        function updateEDonationDeduction() {
            const donation = parseFloat(document.getElementById('eDonation').value) || 0;
            const deduction = donation * 2; // 2 times of donation
            document.getElementById('eDonationAmount').value = formatNumber(deduction);
        }

        function updateGeneralDonationDeduction() {
            const donation = parseNumber(document.getElementById('generalDonation').value);

            // Get all income values
            const salary = parseNumber(document.getElementById('salary').value);
            const bonus = parseNumber(document.getElementById('bonus').value);
            const otherIncome = parseNumber(document.getElementById('otherIncome').value);
            const totalIncome = salary + bonus + otherIncome;
            const expenseDeduction = 100000;

            // Personal deductions
            const personalDeduction = 60000;
            const maritalStatus = document.getElementById('maritalStatus').value;
            const spouseDeduction = (maritalStatus === 'married_no_income') ? 60000 : 0;
            const pregnancyDeduction = Math.min(parseNumber(document.getElementById('pregnancyDeduction').value), 60000);
            const childDeduction = parseNumber(document.getElementById('childDeduction').value);
            const child2561Deduction = parseNumber(document.getElementById('child2561Deduction').value);
            const parentDeduction = parseNumber(document.getElementById('parentDeduction').value);
            const disabledDeduction = parseNumber(document.getElementById('disabledDeduction').value);

            // Economic stimulus deductions
            const easyEReceipt = Math.min(parseNumber(document.getElementById('easyEReceipt').value), 50000);
            const housingInterest = Math.min(parseNumber(document.getElementById('housingInterest').value), 100000);
            const newHomeConstruction = Math.min(parseNumber(document.getElementById('newHomeConstruction').value), 100000);
            const solarCellInstallation = Math.min(parseNumber(document.getElementById('solarCellInstallation').value), 200000);
            const visualArtPurchase = Math.min(parseNumber(document.getElementById('visualArtPurchase').value), 100000);

            // Insurance deductions
            const lifeInsurance = Math.min(parseNumber(document.getElementById('lifeInsurance').value), 100000);
            const healthInsurance = Math.min(parseNumber(document.getElementById('healthInsurance').value), 25000);
            const parentHealthInsurance = Math.min(parseNumber(document.getElementById('parentHealthInsurance').value), 15000);
            const spouseLifeInsurance = Math.min(parseNumber(document.getElementById('spouseLifeInsurance').value), 10000);
            const socialSecurity = Math.min(parseNumber(document.getElementById('socialSecurity').value), 10500);

            // Investment deductions
            const pvdFund = Math.min(parseNumber(document.getElementById('pvdFund').value), 500000);
            const gpfFund = Math.min(parseNumber(document.getElementById('gpfFund').value), 500000);
            const annuityInsurance = Math.min(parseNumber(document.getElementById('annuityInsurance').value), 200000);
            const nsfFund = Math.min(parseNumber(document.getElementById('nsfFund').value), 30000);
            const rmfFund = Math.min(parseNumber(document.getElementById('rmfFund').value), 500000);
            const socialEnterprise = Math.min(parseNumber(document.getElementById('socialEnterprise').value), 100000);
            const thaiEsgFund = Math.min(parseNumber(document.getElementById('thaiEsgFund').value), 300000);

            // Political donation
            const politicalDonation = Math.min(parseNumber(document.getElementById('politicalDonation').value), 10000);

            const basicDeductions = personalDeduction + spouseDeduction + pregnancyDeduction + childDeduction + child2561Deduction + parentDeduction + disabledDeduction + easyEReceipt + housingInterest + newHomeConstruction + solarCellInstallation + visualArtPurchase + lifeInsurance + healthInsurance + parentHealthInsurance + spouseLifeInsurance + socialSecurity;

            // Combined investment deduction cap (cannot exceed 500,000)
            const totalInvestmentRaw = pvdFund + gpfFund + annuityInsurance + nsfFund + rmfFund + thaiEsgFund;
            const totalInvestment = Math.min(totalInvestmentRaw, 500000) + socialEnterprise;

            // Get education donation deduction (which comes before general donation)
            const educationDeductionAmount = parseNumber(document.getElementById('educationDeductionAmount').value);

            // Calculate income after all deductions for donation limit (including education donation)
            const incomeAfterDeductions = Math.max(totalIncome - expenseDeduction - basicDeductions - totalInvestment - politicalDonation - educationDeductionAmount, 0);

            // 10% limit
            const donationLimit = incomeAfterDeductions * 0.10;
            const cappedDonation = Math.min(donation, donationLimit);
            document.getElementById('generalDonationAmount').value = formatNumber(cappedDonation);
        }

        function calculateTax() {
            // Get input values
            const salary = parseNumber(document.getElementById('salary').value);
            const bonus = parseNumber(document.getElementById('bonus').value);
            const otherIncome = parseNumber(document.getElementById('otherIncome').value);
            const expenseDeduction = 100000; // Fixed expense deduction
            const personalDeduction = 60000;
            const pregnancyDeduction = Math.min(parseNumber(document.getElementById('pregnancyDeduction').value), 60000);
            const childDeduction = parseNumber(document.getElementById('childDeduction').value);
            const child2561Deduction = parseNumber(document.getElementById('child2561Deduction').value);
            const parentDeduction = parseNumber(document.getElementById('parentDeduction').value);
            const disabledDeduction = parseNumber(document.getElementById('disabledDeduction').value);

            // Economic stimulus deductions
            const easyEReceipt = Math.min(parseNumber(document.getElementById('easyEReceipt').value), 50000);
            const housingInterest = Math.min(parseNumber(document.getElementById('housingInterest').value), 100000);
            const newHomeConstruction = Math.min(parseNumber(document.getElementById('newHomeConstruction').value), 100000);
            const solarCellInstallation = Math.min(parseNumber(document.getElementById('solarCellInstallation').value), 200000);
            const visualArtPurchase = Math.min(parseNumber(document.getElementById('visualArtPurchase').value), 100000);

            // Life insurance deductions
            const lifeInsurance = Math.min(parseNumber(document.getElementById('lifeInsurance').value), 100000);
            const healthInsurance = Math.min(parseNumber(document.getElementById('healthInsurance').value), 25000);
            const parentHealthInsurance = Math.min(parseNumber(document.getElementById('parentHealthInsurance').value), 15000);
            const spouseLifeInsurance = Math.min(parseNumber(document.getElementById('spouseLifeInsurance').value), 10000);
            const socialSecurity = Math.min(parseNumber(document.getElementById('socialSecurity').value), 10500);

            // Investment deductions
            const pvdFund = Math.min(parseNumber(document.getElementById('pvdFund').value), 500000);
            const gpfFund = Math.min(parseNumber(document.getElementById('gpfFund').value), 500000);
            const annuityInsurance = Math.min(parseNumber(document.getElementById('annuityInsurance').value), 200000);
            const nsfFund = Math.min(parseNumber(document.getElementById('nsfFund').value), 30000);
            const rmfFund = Math.min(parseNumber(document.getElementById('rmfFund').value), 500000);
            const socialEnterprise = Math.min(parseNumber(document.getElementById('socialEnterprise').value), 100000);
            const thaiEsgFund = Math.min(parseNumber(document.getElementById('thaiEsgFund').value), 300000);

            // Donation deductions
            const politicalDonation = Math.min(parseNumber(document.getElementById('politicalDonation').value), 10000);
            const educationDeductionAmount = parseNumber(document.getElementById('educationDeductionAmount').value);
            const generalDonationAmount = parseNumber(document.getElementById('generalDonationAmount').value);
            const eDonationAmount = parseNumber(document.getElementById('eDonationAmount').value);

            // Note: socialSecurity is now the only social security deduction (no fixed contribution)

            // Spouse deduction (only if married with no income spouse)
            const maritalStatus = document.getElementById('maritalStatus').value;
            const spouseDeduction = (maritalStatus === 'married_no_income') ? 60000 : 0;

            // Calculate total income
            const totalIncome = salary + bonus + otherIncome;

            // Calculate basic deductions first (for donation limit calculation)
            const basicDeductions = personalDeduction + spouseDeduction + pregnancyDeduction + childDeduction + child2561Deduction + parentDeduction + disabledDeduction + easyEReceipt + housingInterest + newHomeConstruction + solarCellInstallation + visualArtPurchase + lifeInsurance + healthInsurance + parentHealthInsurance + spouseLifeInsurance + socialSecurity;

            // Combined investment deduction cap (PVD + GPF + Annuity + RMF + NSF + ThaiESG cannot exceed 500,000)
            const totalInvestmentRaw = pvdFund + gpfFund + annuityInsurance + nsfFund + rmfFund + thaiEsgFund;
            const totalInvestment = Math.min(totalInvestmentRaw, 500000) + socialEnterprise;

            // Calculate income after basic deductions for donation limits
            const incomeAfterBasicDeduction = Math.max(totalIncome - expenseDeduction - basicDeductions - totalInvestment - politicalDonation, 0);

            // Donation limits (10% of income after deductions)
            const donationLimit = incomeAfterBasicDeduction * 0.10;
            const educationDeductionCapped = Math.min(educationDeductionAmount, donationLimit);
            const generalDonationCapped = Math.min(generalDonationAmount, donationLimit);
            const eDonationCapped = Math.min(eDonationAmount, donationLimit);

            const totalDeduction = basicDeductions + totalInvestment + politicalDonation + educationDeductionCapped + generalDonationCapped + eDonationCapped;
            const netIncome = Math.max(totalIncome - expenseDeduction - totalDeduction, 0);

            // Calculate progressive tax
            let tax = 0;
            if (netIncome > 5000000) {
                tax += (netIncome - 5000000) * 0.35;
                tax += 1050000; // Tax on first 5M
            } else if (netIncome > 2000000) {
                tax += (netIncome - 2000000) * 0.30;
                tax += 150000; // Tax on first 2M
            } else if (netIncome > 1000000) {
                tax += (netIncome - 1000000) * 0.25;
                tax += 75000; // Tax on first 1M
            } else if (netIncome > 750000) {
                tax += (netIncome - 750000) * 0.20;
                tax += 25000; // Tax on first 750K
            } else if (netIncome > 500000) {
                tax += (netIncome - 500000) * 0.15;
                tax += 10000; // Tax on first 500K
            } else if (netIncome > 300000) {
                tax += (netIncome - 300000) * 0.10;
                tax += 2500; // Tax on first 300K
            } else if (netIncome > 150000) {
                tax += (netIncome - 150000) * 0.05;
            }

            // Display results
            document.getElementById('totalIncome').textContent = totalIncome.toLocaleString() + ' บาท';
            document.getElementById('expenseDeductionResult').textContent = expenseDeduction.toLocaleString() + ' บาท';
            document.getElementById('totalDeduction').textContent = totalDeduction.toLocaleString() + ' บาท';
            document.getElementById('netIncome').textContent = netIncome.toLocaleString() + ' บาท';
            document.getElementById('taxAmount').textContent = tax.toLocaleString() + ' บาท';

            document.getElementById('results').classList.remove('hidden');
        }
    </script>

</body>

</html>